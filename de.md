# Markdown Editor - 项目需求文档

## 项目概述
这是一个基于Python和PyWebView开发的桌面Markdown编辑器，采用所见即所得(WYSIWYG)的编辑方式，类似于Notion的编辑体验。

## 技术栈
- **后端**: Python 3.8+
- **前端框架**: PyWebView (桌面应用容器)
- **前端技术**: HTML5, CSS3, JavaScript (ES6+)
- **主要依赖**:
  - pywebview>=4.0
  - PyInstaller>=5.0
  - pystray>=0.19.0 (系统托盘)
  - Pillow>=9.0.0 (图像处理)
  - pynput>=1.7.0 (全局快捷键)

## 核心功能

### 1. 编辑功能
- **所见即所得编辑**: 实时预览Markdown渲染效果
- **格式化支持**:
  - 标题 (H1, H2, H3)
  - 加粗 (Ctrl+B)
  - 斜体 (Ctrl+I)
  - 代码块和行内代码
  - 链接插入
  - 字体颜色和背景颜色
  - 清除格式

### 2. 列表功能
- **无序列表**: 支持多级嵌套
- **有序列表**: 支持多级嵌套
- **任务列表 (TodoList)**:
  - 支持复选框
  - 支持多级缩进 (Tab/Shift+Tab)
  - 支持层级管理 (增加/减少层级按钮)
  - 支持快速添加待办项
  - 支持标记完成状态

### 3. 特殊块功能
- **折叠块**: 可展开/折叠的内容块
- **标注块**: 支持多种类型
  - [!INFO] - 信息提示
  - [!TIP] - 提示
  - [!WARNING] - 警告
  - [!ERROR] - 错误
  - [!SUCCESS] - 成功
- **引用块**: 支持多级引用
- **分割线**: 插入水平分割线
- **表格**: 插入表格
- **目录**: 自动生成文档目录

### 4. 编辑操作
- **撤销/重做**: 
  - 支持最多50步撤销
  - 快捷键: Ctrl+Z (撤销), Ctrl+Y (重做)
- **自动保存**: 
  - 编辑2秒后自动保存
  - 显示保存状态
- **手动保存**: Ctrl+S 立即保存

### 5. 搜索与替换
- **搜索功能**:
  - 支持区分大小写
  - 支持正则表达式
  - 显示匹配数量
  - 支持上一个/下一个导航
- **替换功能**:
  - 替换当前匹配
  - 替换全部匹配
- **快捷键**: Ctrl+F 打开搜索面板

### 6. 文件管理
- **工作区管理**:
  - 打开文件夹作为工作区
  - VSCode风格文件树
  - 支持文件/文件夹展开和折叠
  - 支持文件/文件夹重命名
  - 支持文件/文件夹删除
  - 支持新建文件和文件夹
- **文件操作**:
  - 新建文件
  - 打开文件
  - 保存文件
  - 最近文件历史记录

### 7. 主题支持
- **浅色主题**: 默认主题
- **深色主题**: 护眼模式
- **主题切换**: 点击按钮切换
- **主题记忆**: 自动保存用户选择的主题

### 8. 系统托盘功能
- **托盘图标**: 
  - 显示在系统托盘区
  - 蓝色背景，白色边框，显示"MD"文字
- **托盘菜单**:
  - 显示/隐藏窗口
  - 显示窗口
  - 隐藏窗口
  - 分隔线
  - 退出应用
- **全局快捷键**: Ctrl+Alt+N 显示/隐藏主窗口
- **窗口行为**:
  - 关闭窗口时最小化到托盘
  - 不真正退出程序
  - 通过托盘菜单退出

## 界面设计

### 布局结构
```
┌─────────────────────────────────────────────────────────┐
│ 侧边栏 (260px) │        主内容区                 │
│                │                                 │
│ ┌────────────┐ │  ┌─────────────────────────┐   │
│ │ 文件树     │ │  │ 工具栏                 │   │
│ │            │ │  ├─────────────────────────┤   │
│ │ - 文件夹   │ │  │ 编辑器区域             │   │
│ │   - 文件   │ │  │ (WYSIWYG)             │   │
│ │ - 文件     │ │  │                       │   │
│ │            │ │  │                       │   │
│ └────────────┘ │  └─────────────────────────┘   │
│                │  状态栏                        │
└─────────────────────────────────────────────────────────┘
```

### 侧边栏
- **宽度**: 260px
- **背景**: 浅灰色 (#f7f6f3)
- **功能**:
  - 侧边栏切换按钮
  - 标题"文件"
  - 新建文件/文件夹按钮
  - VSCode风格文件树
  - 支持折叠/展开

### 工具栏
- **分组**: 6个工具组
  1. 文件与编辑: 新建、打开、保存、撤销、重做
  2. 文本格式: 加粗、斜体、代码、链接、清除格式、字体颜色、背景颜色
  3. 标题: H1、H2、H3
  4. 列表与待办: 无序列表、有序列表、任务列表、引用、添加待办、增加层级、减少层级
  5. 插入功能: 折叠块、标注块、分割线、表格
  6. 工具与视图: 目录、搜索、主题、帮助

### 编辑器区域
- **字体大小**: 16px
- **行高**: 1.7
- **内边距**: 60px (左右)
- **占位符**: "开始输入... 输入 # 可创建标题，**文字** 加粗，*文字* 斜体"

### 状态栏
- **显示内容**:
  - 状态文本 (就绪/操作提示)
  - 字数统计
  - 行数统计
  - 保存状态 (自动保存/未保存/已保存)

## 交互设计

### 快捷键
| 快捷键 | 功能 |
|--------|------|
| Ctrl+B | 加粗 |
| Ctrl+I | 斜体 |
| Ctrl+Z | 撤销 |
| Ctrl+Y | 重做 |
| Ctrl+S | 立即保存 |
| Ctrl+F | 打开搜索面板 |
| Ctrl+Alt+N | 显示/隐藏窗口 (全局) |
| Tab | 增加缩进 |
| Shift+Tab | 减少缩进 |
| Enter | 新建列表项 |

### 鼠标交互
- **文件树**:
  - 单击: 选中文件
  - 双击: 打开文件/展开文件夹
  - 右键: 显示上下文菜单 (重命名、删除)
- **编辑器**:
  - 单击: 设置光标位置
  - 双击: 选中单词
  - 三击: 选中段落
- **工具栏**:
  - 单击: 执行对应功能
  - 悬停: 显示提示信息

### 响应式设计
- **最小窗口**: 900x600
- **默认窗口**: 1400x900
- **侧边栏**: 可折叠
- **工具栏**: 支持水平滚动

## 颜色方案

### 浅色主题
```css
--bg-primary: #ffffff
--bg-secondary: #f7f6f3
--bg-hover: #f1f1ef
--bg-active: #e8e8e6
--text-primary: #37352f
--text-secondary: #787774
--text-tertiary: #9b9a97
--border-color: #e9e9e7
--border-focus: #2383e2
--primary-color: #2383e2
--primary-hover: #1a6cc0
```

### 深色主题
```css
--bg-primary: #191919
--bg-secondary: #202020
--bg-hover: #2a2a2a
--bg-active: #333333
--text-primary: #e8e8e8
--text-secondary: #a0a0a0
--text-tertiary: #707070
--border-color: #3a3a3a
--border-focus: #4a9eff
--primary-color: #4a9eff
--primary-hover: #6aadff
```

## 数据存储

### 文件存储
- **工作区配置**: `~/.markdown_editor_workspace.json`
- **历史记录**: `~/.markdown_editor_history.json`
- **文件格式**: Markdown (.md, .markdown, .txt)

### 数据结构
```json
// 工作区配置
{
  "workspace_path": "/path/to/workspace"
}

// 历史记录
{
  "recent_files": [
    {
      "path": "/path/to/file.md",
      "name": "file.md",
      "timestamp": "2024-01-01T00:00:00"
    }
  ]
}
```

## 打包与部署

### PyInstaller配置
- **输出目录**: `build/`
- **输出文件**: `md-editor.exe`
- **图标**: `icon.png`
- **单文件**: 是
- **窗口模式**: 是
- **包含依赖**: 是

### 打包命令
```bash
pyinstaller --onefile --windowed --icon=icon.png --name=md-editor --add-data="src:src" app.py
```

## 用户要求总结

1. **所见即所得编辑**: 类似Notion的编辑体验
2. **文件树管理**: VSCode风格的文件树
3. **自动保存**: 编辑内容自动保存
4. **撤销/重做**: 支持多步撤销和重做
5. **TodoList增强**: 支持多级缩进和层级管理
6. **特殊块支持**: 折叠块、标注块、目录等
7. **搜索与替换**: 支持正则表达式和批量替换
8. **主题切换**: 支持浅色和深色主题
9. **系统托盘**: 程序在后台运行
10. **全局快捷键**: Ctrl+Alt+N快速打开主界面
11. **窗口行为**: 关闭时最小化到托盘

## 开发注意事项

1. **错误处理**: 所有API调用都需要try-catch
2. **日志记录**: 使用print输出调试信息
3. **性能优化**: 避免频繁的DOM操作
4. **兼容性**: 支持Windows系统
5. **用户体验**: 提供清晰的状态反馈
6. **代码规范**: 遵循Python和JavaScript最佳实践

## 未来扩展

1. **云同步**: 支持云端存储
2. **协作编辑**: 支持多人实时协作
3. **插件系统**: 支持第三方插件
4. **导出功能**: 支持导出为PDF、HTML等格式
5. **模板系统**: 提供常用文档模板
6. **快捷键自定义**: 允许用户自定义快捷键
